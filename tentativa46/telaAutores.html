<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bem-Vindo</title>
        <link rel="stylesheet" id="css-tema" href="css/css.css"/>
        <link href="bootstrap/bootstrap.css" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
      </head>
<div>
  <header>
    <div id="top">&nbsp;</div>
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a href="index.html" class="nav-link active">
          <img id="img-tema" src="img/logo/claro.png" width="80em"
        /></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarScroll"
          aria-controls="navbarScroll"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarScroll">
          <ul
            class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll"
            style="--bs-scroll-height: 100px"
          >
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="livros.html">Livros</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="autores.html">Autores</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="login.html">Login</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="telaAutores.html">autores</a>
            </li>
            <li class="nav-item">
              
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Link
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#login.html">Lo</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </li>
         
          </ul>
          <input type="checkbox" id="tema">      

          <i id="icone-tema" class="fa-solid fa-3x fa-sun" style="color: #fff;"></i>
         
        </input>
          <form class="d-flex" role="search">
            <input
              class="form-control me-2"
              type="search"
              placeholder="Procurar"
              aria-label="Search"
            />
            <button class="editado" type="submit">
              Procurar
            </button>
          </form>
        </div>
      </div>
    </nav>
  </header>
  <div class="banner esquerda"></div>
  <div class="banner direita"></div>
  <!-- Cadastor de iamgems -->
<div
class="modal fade"
id="imagem_modal"
tabindex="-1"
aria-labelledby="exampleModalLabel"
aria-hidden="true"
>
<div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
      <h1 class="modal-title fs-5" id="exampleModalLabel">
        Cadastro de Imagens
      </h1>
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="modal"
        aria-label="Close"
      ></button>
    </div>
    <div class="modal-body cate">
      <center>
        <div class="card-modal">
         <div class="mx-auto" style="width: 50%">
           <div class="inputBox">
             <div class="form-group">
               <span class="user">Imagem do Autor</span>
             <label class="custom-file-upload">
               <i class="fas fa-cloud-upload"></i> Escolha um arquivo
               <input
                 type="file"
                 id="arquivo"
                 name="arquivo"
                 accept="image/jpeg, image/png"
               />
             </label>
               <br>
             </div> 
               <br>
             <div id="fileMessage" class="file-message"></div>
           </div>
         </div>
        </div>
      </center>
    </div>
    <div class="modal-footer">
      <button type="button" class="exit" data-bs-dismiss="modal">
        Cancelar
      </button>
      <button
        type="button"
        class="enter"
        data-bs-dismiss="modal"
        onclick="cadastrarFoto()"
      >
        Cadastrar
      </button>
    </div>
  </div>
</div>
</div>

<script>
/*
a = sessionStorage.getItem('logado');
if(a == 'sim'){
  document.write("logado");
}
else{
  document.write("deslogado");

}
*/
function modalImagem(){
var myModal = new bootstrap.Modal(
     document.getElementById("imagem_modal")
   );
   myModal.show();
 }
var linkTema = document.getElementById("css-tema");
      var icone = document.getElementById("icone-tema");
      var img = document.getElementById("img-tema");
      var temaClaro = "css/css.css";
      var temaEscuro = "css/escuro.css";

      function mudarParaClaro() {
          sessionStorage.setItem("tema", "claro");
          linkTema.href = "css/css.css";
          icone.className = "fa-solid fa-2x fa-sun";
          img.src = "img/logo/claro.png";
      }

      function mudarParaEscuro() {
          sessionStorage.setItem("tema", "escuro");
          linkTema.href = "css/escuro.css";
          icone.className = "fa-solid fa-2x fa-moon";
          img.src = "img/logo/escuro.png";

      }

      icone.addEventListener("click", function () {
          if (tema.checked) {
              tema.checked = false;
              mudarParaEscuro();
          } else {
              tema.checked = true;
              mudarParaClaro();
          }
      });

      // Verifique o tema armazenado na sessionStorage e configure-o inicialmente
      if (sessionStorage.getItem("tema") === "escuro") {
          mudarParaEscuro();
      } else {
          mudarParaClaro();
      }

      document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.querySelector('.custom-file-upload input[type="file"]');
            const fileMessage = document.querySelector('.file-message');

            function handleFileChange() {
                if (fileInput.files.length > 0) {
                    const fileName = fileInput.files[0].name;
                    const fileExtension = fileName.split('.').pop().toLowerCase();
                    const allowedExtensions = ['jpg', 'jpeg', 'png', 'jfif'];

                    if (allowedExtensions.includes(fileExtension)) {
                        fileMessage.innerHTML = `Imagem "${fileName}" enviada com sucesso!`;
                        fileMessage.style.color = 'green';
                    } else {
                        fileMessage.innerHTML = 'Apenas imagens (jpg, jpeg, png, jfif) são permitidas.';
                        fileMessage.style.color = 'red';
                        fileInput.value = '';
                    }

                    fileMessage.style.display = 'block';
                } else {
                    fileMessage.style.display = 'none';
                }
            }

            fileInput.addEventListener('change', handleFileChange);
        });
        window.addEventListener('load', (event) => {
    carregarAutores();
    carregarLivroAutor();
        });
        function carregarAutores(){
          var queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    var codigo = urlParams.get('codigo');    
    var categoria = urlParams.get('categoria');    
    var periodo = urlParams.get('periodo');    
    var url = `php/autores/autor_selecionado.php?codigo=${codigo}`; 
var informacoes = "";
document.getElementsByName('codigo_autor').value = codigo;  

    fetch(url)
        .then((response) => response.json())
        .then((data) => {
            console.log(data);

            for(let item in data){
      
var a = `${data[item].tb03_obito}`;
            if(a === "0000"){
              a = "Vivo";
            }
            
               informacoes += `
               <div class="row">
          <div class="col-md-3">
            <h3 class="titulo" style="white-space: nowrap; margin-top: 10%"> ${data[item].tb03_nome_autor} 
              <br><input type="text" id="nome_autor_editado">
</h3>
            <img src="img/autores/${data[item].tb03_foto}" style="width: 100%; margin-top: 10%" alt="Imagem de Livro">
            <div class="d-flex flex-column align-items-center">
                <a href="#" onclick="editarFoto(${data[item].tb03_id_autor})"class="icone"><br>
    <i class="fa-solid fa-2x fa-image" id="icon-foto"></i></a>

            </div>
        </div>
         
            <div class="col-md-9 biografia" style="margin-top: 7%; padding-left: 10%;" >
              <div class="row">
                <div class="col-md-6">
                    <button class="btniconedt">
                      <a href="#" onclick="mostraCampo('${data[item].tb03_nome_autor}', ${data[item].tb03_id_autor}, 
'${data[item].tb03_nacionalidade}', '${data[item].tb03_nascimento}', '${data[item].tb03_obito}', 
'${data[item].tb03_biografia}')" class="icone">
<i class="fas fa-edit fa-2x icone edt">            
      </i>  
</a>
                         </i>
                    </button>
                    </div>
                    
                <div class="col-md-6">
                  <button class="btnicon">

                     <a href="#" onclick="apagarLivro(${data[item].tb03_id_autor}, '${data[item].tb03_nome_autor}')"class="icone">
                      <i class="fa-solid fa-2x fa-trash" style="color: #ed0c0c;"></i> 
          
</a>
                   </button>             
                  </div>
                </div>
                <i class="fa-solid fa-calendar-days" style="color: #0c65a0;">&nbsp ${data[item].tb03_nascimento} - ${a} &nbsp</i> 
                <br>  <span id="campos_nascimento_falecimento"> <input type="text" id="data_nascimento_editada"> - <input type="text" id="data_falecimento_editada"> </span>
                <br>
                <i class="fa-solid fa-location-dot" style="color: #0c65a0; ">&nbsp  ${data[item].tb03_nacionalidade}</i> 
                <br> <input type="text" id="nacionalidade_editada">
                <br>
                <br>
           
              <h3 class="titulo" style="font-size: 25px;">Biografia &nbsp   
              <h5 class="bio" style="font-size: 13px;">
               ${data[item].tb03_biografia}
               <br><input type="text" id="biografia_editada">

              </h5>
 <div class="row">
  <div class="col-md-6">
    <h3 class="titulo"> Categoria </h3>
    <h5> ${data[item].tb04_nome_categoria}
      <select name="select" id="select_categoria_editada">

</select>
</h5>
    </div>
    <div class="col-md-6">
      <h3 class="titulo"> Período </h3>
      <h5> ${data[item].tb05_nome_periodo}
        <select name="select" id="select_periodo_editado">

</select>
</h5>

      </div>
      </div>
      <input type="hidden" name="codigo_autor" id="codigo_autor">
            </div>
            <center>
              <button class="btn btn-primary" onclick="someCampos()" id="botao_cancelar"> Cancelar </button>
              <button class="btn btn-primary"                   
              onclick="editarAutor()" id="botao_editar"> Atualizar </button>
              </center>
            `;
            }
           
            
            document.querySelector("#autor").innerHTML = informacoes;
        })
        .catch((error) => {
            console.error("Erro na requisição fetch:", error);
        });
        }
        function someCampos() {
          var nome = document.querySelector("#nome_autor_editado");
  var nacionalidade = document.querySelector("#nacionalidade_editada");
  var nascimento_falecimento = document.querySelector("#campos_nascimento_falecimento");
  var biografia = document.querySelector("#biografia_editada");
  var botao_editar = document.getElementById('botao_editar');
  var botao_cancelar = document.getElementById('botao_cancelar');
  var categoria = document.querySelector("#select_categoria_editada");
  var periodo = document.querySelector("#select_periodo_editado");
  var foto = document.querySelector("#icon-foto");

foto.style.display = "none";

 periodo.style.display = "none";
    categoria.style.display = "none";
    nome.style.display = "none";
    nacionalidade.style.display = "none";
    nascimento_falecimento.style.display = "none";
    biografia.style.display = "none";
    botao_editar.style.display = "none";
    botao_cancelar.style.display = "none";
}
function editarFoto(codigo){
  document.getElementById('codigo_autor').value = codigo;
  modalImagem();
}
function cadastrarFoto(){
    const formData = new FormData();
    var foto = document.getElementById('arquivo').files[0];
    var codigo = document.getElementById('codigo_autor').value;


    formData.append("codigo", codigo);
    formData.append("arquivo", foto);
        url = `php/autores/foto_cadastro.php`;
    

    fetch(url, {
        method: "POST",
        body: formData,
    })
    .then((response) => response.json()) 
    .then((data) => {
        console.log(data);
        alert(data.mensagem);
        carregarAutores();
    })
    .catch((error) => {
        console.error("Erro na requisição fetch:", error);
    });
}
function editarAutor(){
    const formData = new FormData();
var codigo = document.getElementById('codigo_autor').value;

  var nome = document.querySelector("#nome_autor_editado").value;
  var nacionalidade = document.querySelector("#nacionalidade_editada").value;
  var nascimento = document.querySelector("#data_nascimento_editada").value;
  var falecimento = document.querySelector("#data_falecimento_editada").value;
  var biografia = document.querySelector("#biografia_editada").value;

    var categoria = document.getElementById('select_categoria_editada');
    var valor_categoria = categoria.options[categoria.selectedIndex].value;

    var periodo = document.getElementById('select_periodo_editado');
    var valor_periodo = periodo.options[periodo.selectedIndex].value;

    formData.append("codigo", codigo);
    formData.append("nome", nome);
    formData.append("nacionalidade", nacionalidade);
    formData.append("nascimento", nascimento);
    formData.append("falecimento", falecimento);
    formData.append("biografia", biografia);

    formData.append("categoria", valor_categoria);
    formData.append("periodo", valor_periodo);
   
    var url = "";

    if (nome != null || nome != "") {
        url = `php/autores/autor_editar.php`;
      }
      else{
        alert("digita");
      }
    fetch(url, {
        method: "POST",
        body: formData,
    })
    .then((response) => response.json()) 
    .then((data) => {
        console.log(data);
        alert(data.mensagem);
        location.reload();
    })
    .catch((error) => {
        console.error("Erro na requisição fetch:", error);
    });
}


function apareceCampos() {
  var nome = document.querySelector("#nome_autor_editado");
  var nacionalidade = document.querySelector("#nacionalidade_editada");
  var nascimento_falecimento = document.querySelector("#campos_nascimento_falecimento");
  var biografia = document.querySelector("#biografia_editada");
  var categoria = document.querySelector("#select_categoria_editada");
  var periodo = document.querySelector("#select_periodo_editado");
  var foto = document.querySelector("#icon-foto");

  var botao_editar = document.getElementById('botao_editar');
  var botao_cancelar = document.getElementById('botao_cancelar');
    nome.style.display = "block";
    nacionalidade.style.display = "block";
    nascimento_falecimento.style.display = "block";
    biografia.style.display = "block";
    periodo.style.display = "block";
    categoria.style.display = "block";
    botao_editar.style.display = "block";
    botao_cancelar.style.display = "block";
    foto.style.display = "block";

}

function mostraCampo(nomeAutor, codigoAutor, nacionalidade, nascimento, falecimento, biografia){
  apareceCampos();
  carregaPeriodos();
    carregarCategorias();
 document.querySelector("#codigo_autor").value = codigoAutor;
 

  

  document.querySelector("#nome_autor_editado").value = nomeAutor;
  document.querySelector("#nacionalidade_editada").value = nacionalidade;
  document.querySelector("#data_nascimento_editada").value = nascimento;
  document.querySelector("#data_falecimento_editada").value = falecimento;
  document.querySelector("#biografia_editada").value = biografia;
  document.querySelector("#biografia_editada").value = biografia;
  
}

                  function apagarLivro(codigo, nome){
                    var url = 'php/livros/livro_excluir.php?codigo=' + codigo;
if (confirm("Deseja realmente excluir:  "+ nome + "?")) {
    fetch(url)
        .then((response) => response.json())
        .then((data) => {
          window.location.href = "autores.html";       
         })
  }
}
function carregaPeriodos() {
    var url = "php/periodos/periodo.php";

    fetch(url)
        .then((response) => response.json())
        .then((data) => {
            console.log(data);

            var options = "";
for(let item in data){
  options += `
  <option value="${data[item].tb05_nome_periodo}" name="${data[item].tb05_nome_periodo}">${data[item].tb05_nome_periodo}</option>`; // Ajuste dos campos

}
            

var selectElement = document.querySelector("#select_periodo_editado").innerHTML = options;
        });
}
function carregarCategorias() {
    var url = "php/categorias/categoria.php";

    fetch(url)
        .then((response) => response.json())
        .then((data) => {
            console.log(data);

            var options = "";
for(let item in data){
  options += `<option value="${data[item].tb04_nome_categoria}" name="${data[item].tb04_nome_categoria}">${data[item].tb04_nome_categoria}</option>`; // Ajuste dos campos

}
            

document.querySelector("#select_categoria_editada").innerHTML = options;
        });
}
function carregarLivroAutor() {
  var queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  var codigo = urlParams.get('codigo');

  var url = `php/autores/autor_livro.php?codigo=${codigo}`;
  fetch(url)
    .then((response) => response.json())
    .then((data) => {
      console.log(data);

      var informacoes = ""; // Inicialize como uma string vazia

      for (let item in data) {
        var contador = 1;
        informacoes += `
          <div class="row  linha-baixo1  col-main">
            <h1 class="">baguio</h1>
            <div class="col-sm">
              <a href="telalivro.html?codigo=${data[item].tb01_id_livro}">
                <img src="img/livros/${data[item].tb01_ftcapa}" style="height: 80%;" class="livros" alt="Livro1" />
              </a>  
              <p>${data[item].tb01_nome_livro}</p>
            </div>
          </div>
        </div>`;
      }

      document.getElementById('livroses').innerHTML = informacoes; // Use innerHTML para adicionar o HTML gerado à sua div
    });
}




</script>
      <div class="container font-monospace">
          <div id="autor">

          </div>
      <center>
        
          
     <hr>
     <div id="livroses">
AOAO
     </div>
         
          
          
       
       
   
          </div>
        </div>
      </center>
    </div>
  </div>
  <center>


    <script src="bootstrap/bootstrap.js"></script>
    
</body>
</html>