<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bem-Vindo</title>
        <link rel="stylesheet" id="css-tema" href="css/css.css"/>
        <link href="bootstrap/bootstrap.css" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
      </head>
<div>
  <header>
    <div id="top">&nbsp;</div>
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a href="index.html" class="nav-link active">
          <img id="img-tema" src="img/logo/claro.png" width="80em"
        /></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarScroll"
          aria-controls="navbarScroll"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarScroll">
          <ul
            class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll"
            style="--bs-scroll-height: 100px"
          >
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="livros.html">Livros</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="autores.html">Autores</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="login.html">Login</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="telaAutores.html">autores</a>
            </li>
            <li class="nav-item">
              
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Link
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#login.html">Lo</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </li>
         
          </ul>
          <input type="checkbox" id="tema">      

          <i id="icone-tema" class="fa-solid fa-3x fa-sun" style="color: #fff;"></i>
         
        </input>
          <form class="d-flex" role="search">
            <input
              class="form-control me-2"
              type="search"
              placeholder="Procurar"
              aria-label="Search"
            />
            <button class="editado" type="submit">
              Procurar
            </button>
          </form>
        </div>
      </div>
    </nav>
  </header>
  <div class="banner esquerda"></div>
  <div class="banner direita"></div>

<script>
/*
a = sessionStorage.getItem('logado');
if(a == 'sim'){
  document.write("logado");
}
else{
  document.write("deslogado");

}
*/
var linkTema = document.getElementById("css-tema");
      var icone = document.getElementById("icone-tema");
      var img = document.getElementById("img-tema");
      var temaClaro = "css/css.css";
      var temaEscuro = "css/escuro.css";

      function mudarParaClaro() {
          sessionStorage.setItem("tema", "claro");
          linkTema.href = "css/css.css";
          icone.className = "fa-solid fa-2x fa-sun";
          img.src = "img/logo/claro.png";
      }

      function mudarParaEscuro() {
          sessionStorage.setItem("tema", "escuro");
          linkTema.href = "css/escuro.css";
          icone.className = "fa-solid fa-2x fa-moon";
          img.src = "img/logo/escuro.png";

      }

      icone.addEventListener("click", function () {
          if (tema.checked) {
              tema.checked = false;
              mudarParaEscuro();
          } else {
              tema.checked = true;
              mudarParaClaro();
          }
      });

      // Verifique o tema armazenado na sessionStorage e configure-o inicialmente
      if (sessionStorage.getItem("tema") === "escuro") {
          mudarParaEscuro();
      } else {
          mudarParaClaro();
      }
      window.addEventListener('load', (event) => {
    carregarLivros();
    carregarAutores();
    carregarCategorias();
    carregaPeriodos();
        });
        function carregarLivros(){
          var queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    var codigo = urlParams.get('codigo');    
    var url = `php/livros/livro_selecionado.php?codigo=${codigo}`; 
    
var informacoes = "";
    fetch(url)
        .then((response) => response.json())
        .then((data) => {
            console.log(data);          
            for(let item in data){
              /*
              a = `${data[item].tb03_obito_formatado}`;
            if(a === '00/00/0000'){
              a = "Vivo";
            }
            */
               informacoes += `
               <div class="row">
            <div class="col-md-2 text-left">
              <a href="pdf/${data[item].tb01_pdf}">

                <img src="img/livros/${data[item].tb01_ftcapa}" style="max-width: 100%; padding-top: 100px;" alt="Imagem de Livro">
              </a>
  <a href="pdf/${data[item].tb01_pdf}" download="${data[item].tb01_pdf}">
                <button class="download">
                    <i class="fa-solid fa-download"></i>
                  </button>
                  </a>
         
            </div> 
            <div class="col-md-8" style="padding-top: 100px;">
              <div class="row">
                <div class="col-md-4">
                  <h3 class="titulo">${data[item].tb01_nome_livro}
                    
                    
                    <input type="text"id="nome_editado">
                    
                    </h3>
                </div>
                <div class="col-md-4">
                  <button class="btniconedt" 
                  onclick="mostraCampos(${data[item].tb01_id_livro}, '${data[item].tb01_nome_livro}', '${data[item].tb01_editora}','${data[item].tb01_data_formatada}','${data[item].tb01_sinopse}')">
                    <i class="fas fa-edit fa-2x icone edt">            
                       </i>
                  </button>
                       </div>
                <div class="col-md-4">
                  <button class="btnicon"
                  onclick="apagarLivro(${data[item].tb01_id_livro}, '${data[item].tb01_nome_livro}')">
                    <i class="fa-solid fa-2x fa-trash" style="color: #ed0c0c;">
                   </button></i>              
                  </div>
                
              </div>
              

    <h6>Por <a href="telaAutores.html?codigo=${data[item].tb01_id_autor}">${data[item].nome_autor}</a>
      
      <select name="select" id="select_autor_editado">

</select>      (autor)</h6><br><br>
    <h5>${data[item].tb01_sinopse}

      <input type="text" id="sinopse_editada">
      
    </h5>
    <div class="row" id="colicon">
      <div class="col-md-3">
        <h6> Editora</h6>
        <i class="fa-solid  fa-2x fa-building" style="color: #1B69A6;"></i>
        <h6 id="subtitulo">${data[item].tb01_editora}
          
          <input type="text"id="editora_editada">
          
          </h6>
      </div>
      <div class="col-md-2">
        <h6> Período </h6>
        <i class="fas fa-2x fa-list-alt" aria-hidden="true" style="color: #1B69A6;"></i>
        <h6 id="subtitulo">${data[item].nome_periodo}
          
           <select name="select" id="select_periodo_editado">

</select> </h6>
      </div>
      <div class="col-md-2">
        <h6> Categoria </h6>
        <i class="fas fa-2x fa-list-alt" aria-hidden="true" style="color: #1B69A6;"></i>
        <h6 id="subtitulo">${data[item].nome_categoria}
          
          <select name="select" id="select_categoria_editada">

</select> </h6>
      </div>
      <div class="col-md-3">
        <h6> Data de Publicação</h6>
        <i class="fa-solid fa-2x fa-calendar" style="color: #1B69A6;"></i>
        <h6 id="subtitulo">${data[item].tb01_data_formatada}
          
          <input type="date" id="data_editada">


          </h6>
      </div>
      <div class="col-md-2">
        <h6> Idade de Leitura</h6>
        <i class="fa-solid   fa-2x fa-child"style="color: #1B69A6; "></i>
        <h6 id="subtitulo">${data[item].tb01_classificacao_indicativa}
          
          <select name="select" id="select_classificacao_editada">
            <option id="livre" value="Livre">Livre</option>
            <option id="dez" value="+10 anos">10 Anos</option>
            <option id="doze" value="+12 anos">12 Anos</option>
            <option id="quatorze" value="+14 anos">14 Anos</option>
            <option id="dezoito" value="+18 anos">18 Anos</option>
          </select> 


          </h6>
      </div>
      <h1> Sala: ${data[item].nome_sala} </h1>
      <select name="select" id="select_sala_editada">
        <option id="sem" value="Sem sala"> Sem sala </option>
        <option class="read-only"" value="Sem sala"> Fundamental 1 </option>
            <option id="F11ano" value="Ensino Fundamental 1 - 1° Ano">1° Ano</option>
            <option id="F12ano" value="Ensino Fundamental 1 - 2° Ano">2° Ano</option>
            <option id="F13ano" value="Ensino Fundamental 1° - 3° Ano">3° Ano</option>
            <option id="F14ano" value="Ensino Fundamental 1° - 4° Ano">4° Ano</option>
            <option id="F15ano" value="Ensino Fundamental 1° - 5° Ano">5° Ano</option>
            <option class="read-only" value="Sem sala"> Fundamental 2 </option>
            <option id="F26ano" value="Ensino Fundamental 2° - 6° Ano">6° Ano</option>
            <option id="F27ano" value="Ensino Fundamental 2° - 7° Ano">7° Ano</option>
            <option id="F28ano" value="Ensino Fundamental 2° - 8° Ano">8° Ano</option>
            <option id="F29ano" value="Ensino Fundamental 2° - 9° Ano">9° Ano</option>
                    <option class="read-only" value="Sem sala"> Ensino Médio </option>

            <option id="M1ano" value="Ensino Médio - 1° Ano">1° Ano</option>
            <option id="M2ano" value="Ensino Médio - 2° Ano">2° Ano</option>
            <option id="M3ano" value="Ensino Médio - 3° Ano">3° Ano</option>

          </select>
    </div>
            </div> 
            <center>
              <button class="btn btn-primary" onclick="someCampos()" id="botao_cancelar"> Cancelar </button>
              <button class="btn btn-primary"                   
              onclick="editarLivro()" id="botao_editar"> Atualizar </button>
              </center>
            </div>
            <input type="hidden" id="codigo_livro">
            `;
            }


            document.querySelector(".container").innerHTML = informacoes;
const readOnlyOptions = document.querySelectorAll('.read-only');

readOnlyOptions.forEach(option => {
    option.disabled = true;
});
        })
        .catch((error) => {
            console.error("Erro na requisição fetch:", error);
        });
        }
        function editarLivro(){
                              const formData = new FormData();

          var codigo = document.getElementById('codigo_livro').value;
          var nome = document.getElementById('nome_editado').value ;
  var editora = document.getElementById('editora_editada').value;
  var data = document.getElementById('data_editada').value;
  var sinopse = document.getElementById('sinopse_editada').value;
  var autor = document.getElementById('select_autor_editado');
    var valor_autor = autor.options[autor.selectedIndex].value;
    var categoria = document.getElementById('select_categoria_editada');
    var valor_categoria = categoria.options[categoria.selectedIndex].value;

    var periodo = document.getElementById('select_periodo_editado');
    var valor_periodo = periodo.options[periodo.selectedIndex].value;

    var sala = document.getElementById('select_sala_editada');
    var valor_sala = sala.options[sala.selectedIndex].value;


    var classificacao = document.getElementById('select_classificacao_editada');
    var valor_classificacao = classificacao.options[classificacao.selectedIndex].value;
    
    formData.append("codigo", codigo);
    formData.append("livro", nome);
    formData.append("editora", editora);
    formData.append("publicacao", data);
    formData.append("sinopse", sinopse);
    formData.append("autor", valor_autor);
    formData.append("categoria", valor_categoria);
    formData.append("periodo", valor_periodo);
    formData.append("sala", valor_sala);
    formData.append("classificacao", valor_classificacao);
   
    var url = "";

    if (nome != null || nome != "") {
        url = `php/livros/livro_editar.php`;
      }
      else{
        alert("digita");
      }
    fetch(url, {
        method: "POST",
        body: formData,
    })
    .then((response) => response.json()) 
    .then((data) => {
        console.log(data);
        alert(data.mensagem);
    reload();
    })
    .catch((error) => {
        console.error("Erro na requisição fetch:", error);
    });
}

        
        function apagarLivro(codigo, nome){
                    var url = 'php/livro/livro_excluir.php?codigo=' + codigo
if (confirm("Deseja realmente excluir: "+ nome + "?")) {
    fetch(url)
        .then((response) => response.json())
        .then((data) => {

        })
  }
}
function apareceCampos() {
    var codigo = document.getElementById('codigo_livro');
    var nome = document.getElementById('nome_editado');
    var editora = document.getElementById('editora_editada');
    var data = document.getElementById('data_editada');
    var sinopse = document.getElementById('sinopse_editada');
    var autor = document.getElementById('select_autor_editado');
    var categoria = document.getElementById('select_categoria_editada');
    var periodo = document.getElementById('select_periodo_editado');
    var sala = document.getElementById('select_sala_editada');
    var classificacao = document.getElementById('select_classificacao_editada');
  var botao_editar = document.getElementById('botao_editar');
  var botao_cancelar = document.getElementById('botao_cancelar');
    codigo.style.display = "block";
    nome.style.display = "block";
    editora.style.display = "block";
    data.style.display = "block";
    sinopse.style.display = "block";
    autor.style.display = "block";
    categoria.style.display = "block";
    periodo.style.display = "block";
    sala.style.display = "block";
    classificacao.style.display = "block";
    botao_editar.style.display = "block";
    botao_cancelar.style.display = "block";

}
function someCampos() {
    var codigo = document.getElementById('codigo_livro');
    var nome = document.getElementById('nome_editado');
    var editora = document.getElementById('editora_editada');
    var data = document.getElementById('data_editada');
    var sinopse = document.getElementById('sinopse_editada');
    var autor = document.getElementById('select_autor_editado');
    var categoria = document.getElementById('select_categoria_editada');
    var periodo = document.getElementById('select_periodo_editado');
    var sala = document.getElementById('select_sala_editada');
    var classificacao = document.getElementById('select_classificacao_editada');
    var botao_editar = document.getElementById('botao_editar');
  var botao_cancelar = document.getElementById('botao_cancelar');
    botao_editar.style.display = "none";
    botao_cancelar.style.display = "none";
    codigo.style.display = "none";
    nome.style.display = "none";
    editora.style.display = "none";
    data.style.display = "none";
    sinopse.style.display = "none";
    autor.style.display = "none";
    categoria.style.display = "none";
    periodo.style.display = "none";
    sala.style.display = "none";
    classificacao.style.display = "none";
}
function mostraCampos(codigo, nome, editora, data, sinopse){
apareceCampos();
  document.getElementById('codigo_livro').value = codigo;
  document.getElementById('nome_editado').value = nome;
  document.getElementById('editora_editada').value = editora;
  var dataLivro = new Date(data);
  var dataFormatadaLivro = dataLivro.toISOString().split("T")[0];
  document.getElementById('data_editada').value = dataFormatadaLivro;
  document.getElementById('sinopse_editada').value = sinopse;
}

function carregarAutores(){
  var url = "php/autores/autor.php";

fetch(url)
    .then((response) => response.json())
    .then((data) => {
        console.log(data);
        var options = "";
for(let item in data){
  options += `<option value="${data[item].tb03_nome_autor}">${data[item].tb03_nome_autor}</option>`; 

}
        

document.querySelector("#select_autor_editado").innerHTML = options;
    });
}
function carregaPeriodos() {
    var url = "php/periodos/periodo.php";

    fetch(url)
        .then((response) => response.json())
        .then((data) => {
            console.log(data);
            var options = "";
for(let item in data){
  options += `
  <option value="${data[item].tb05_nome_periodo}" name="${data[item].tb05_nome_periodo}">${data[item].tb05_nome_periodo}</option>`; // Ajuste dos campos

}
            

var selectElement = document.querySelector("#select_periodo_editado").innerHTML = options;
        });
}
function carregarCategorias() {
    var url = "php/categorias/categoria.php";

    fetch(url)
        .then((response) => response.json())
        .then((data) => {
            console.log(data);
            var options = "";
for(let item in data){
  options += `<option value="${data[item].tb04_nome_categoria}" name="${data[item].tb04_nome_categoria}">${data[item].tb04_nome_categoria}</option>`; // Ajuste dos campos

}
            

document.querySelector("#select_categoria_editada").innerHTML = options;
        });
}
</script>
      <div class="container font-monospace">
    </div>
    </div>

    <script src="bootstrap/bootstrap.js"></script>

    
</body>
</html>